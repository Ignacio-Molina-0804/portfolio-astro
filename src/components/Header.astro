---
import SolIcon from "./icons/Sol.astro";
import LunaIcon from "./icons/Luna.astro";
import InstallIcon from "./icons/Install.astro";

import { useTranslations } from "../i18n/util";
import { languageList } from "../i18n/ui";

const currentLang = Astro.currentLocale || "es";
const t = useTranslations(currentLang as keyof typeof languageList);

const cvFile = currentLang === 'es' ? 'CV_Ignacio_Molina_ES.pdf' : 'CV_Ignacio_Molina_EN.pdf';
const cvDownloadName = currentLang === 'es' ? 'CV-Ignacio-Molina-Desarrollador.pdf' : 'CV-Ignacio-Molina-Developer.pdf';
---

<header
  class="fixed top-0 left-0 w-full z-50 bg-gray-500/70 dark:bg-black/70 backdrop-blur-md"
>
  <div
    class="flex justify-between items-center w-full xl:w-[1120px] mx-auto py-4 px-4 md:py-6"
  >
    <!-- Menú hamburguesa solo en móvil -->
    <div class="md:hidden relative">
      <button id="menu-toggle" class="p-2 text-white focus:outline-none">
        <svg
          class="w-6 h-6 transition-transform duration-300"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>

      <!-- Menú desplegable con transiciones -->
      <div
        id="mobile-menu"
        class="absolute left-0 mt-2 w-56 bg-gray-700 dark:bg-gray-800 rounded-md shadow-lg z-50
           transform opacity-0 scale-95
           transition-all duration-300 ease-out
           origin-top-left
           pointer-events-none
           max-h-0 overflow-hidden"
      >
        <div class="px-2 py-2 space-y-1">
          <a
            class="block px-3 py-2 text-white hover:bg-gray-600 rounded-md text-sm"
            href="#top">{t("header.home")}</a
          >
          <a
            class="block px-3 py-2 text-white hover:bg-gray-600 rounded-md text-sm"
            href="#experiencia">{t("header.experience")}</a
          >
          <a
            class="block px-3 py-2 text-white hover:bg-gray-600 rounded-md text-sm"
            href="#proyectos">{t("header.projects")}</a
          >
          <a
            class="block px-3 py-2 text-white hover:bg-gray-600 rounded-md text-sm"
            href="#sobre-mi">{t("header.aboutme")}</a
          >
          <a
            class="block px-3 py-2 text-white hover:bg-gray-600 rounded-md text-sm"
            href="#conocimientos">{t("header.skills")}</a
          >
          <a
            class="block px-3 py-2 text-white hover:bg-gray-600 rounded-md text-sm"
            href="#contacto">{t("header.contact")}</a
          >
          <a
            class="px-3 py-2 text-amber-400 hover:bg-amber-400/10 rounded-md text-sm border border-amber-400 flex items-center gap-2"
            href={`/${cvFile}`}
            download={cvDownloadName}
          >
            <InstallIcon />
            CV
          </a>
        </div>
      </div>
    </div>

    <!-- Menú normal para desktop -->
    <nav class="hidden md:flex flex-row items-center gap-x-6 lg:gap-x-8">
      <a
        class="text-white hover:text-blue-200 transition-colors duration-200 text-sm lg:text-base"
        href="#top">{t("header.home")}</a
      >
      <a
        class="text-white hover:text-blue-200 transition-colors duration-200 text-sm lg:text-base"
        href="#experiencia">{t("header.experience")}</a
      >
      <a
        class="text-white hover:text-blue-200 transition-colors duration-200 text-sm lg:text-base"
        href="#proyectos">{t("header.projects")}</a
      >
      <a
        class="text-white hover:text-blue-200 transition-colors duration-200 text-sm lg:text-base"
        href="#sobre-mi">{t("header.aboutme")}</a
      >
      <a
        class="text-white hover:text-blue-200 transition-colors duration-200 text-sm lg:text-base"
        href="#conocimientos">{t("header.skills")}</a
      >
      <a
        class="text-white hover:text-blue-200 transition-colors duration-200 text-sm lg:text-base"
        href="#contacto">{t("header.contact")}</a
      >
      <a
        href={`/${cvFile}`}
        download={cvDownloadName}
        class="px-3 py-1.5 bg-transparent border border-amber-400 text-amber-400 hover:bg-amber-400/10 rounded-md transition-all duration-300 flex items-center gap-2 text-sm"
      >
        <InstallIcon />
        <span>CV</span>
      </a>
    </nav>

    <div class="flex items-center gap-2">
      <button
        id="theme-toggle"
        class="p-2 rounded-full bg-gray-700 hover:bg-gray-600 transition-all duration-300 mx-5"
        aria-label="Cambiar modo claro/oscuro"
        title="Cambiar tema"
      >
        <div class="relative w-5 h-5">
          <SolIcon />
          <LunaIcon />
        </div>
      </button>

      <button
        id="language-toggle"
        class="p-2 rounded-full bg-gray-700 hover:bg-gray-600 transition-all duration-300 text-white text-sm"
        aria-label="Cambiar idioma"
        title="Cambiar idioma"
      >
        <span id="language-label"
          ><img
            src="https://flagcdn.com/w2560/us.webp"
            alt="Bandera de Estados Unidos"
            class="block mx-auto w-[34px] h-auto rounded-full select-none cursor-pointer bg-[hsl(0,0%,90%)] transition-colors duration-300"
          />
        </span>
      </button>
    </div>
  </div>

  <script>
    import "/src/scripts/MenuPhone.ts";
    import "/src/scripts/ChangeMode.ts";
    import "/src/scripts/ChangeLenguage.ts";
  </script>
</header>