---
import Line from "./Line.astro";
import SocialPill from "./SocialPill.astro";

import AstroIcon from "./icons/Astro.astro";
import JavaScriptIcon from "./icons/JavaScript.astro";
import TypeScriptIcon from "./icons/TypeScript.astro";
import TailwindIcon from "./icons/TailwindCSS.astro";
import GithubIcon from "./icons/GitHub.astro";
import EnterIcon from "./icons/Enter.astro";
import ReactIcon from "./icons/React.astro";
import ReduxIcon from "./icons/Redux.astro";
import JavaIcon from "./icons/Java.astro";
import SpringIcon from "./icons/SpringBoot.astro";
import PostgresIcon from "./icons/Postgres.astro";
import CSSIcon from "./icons/CSS.astro";

import projects from "../data/ProjectData.json";
import { useTranslations } from "../i18n/util";
import { languageList } from "../i18n/ui";

const currentLang = Astro.currentLocale || "es";
const t = useTranslations(currentLang as keyof typeof languageList);

// Mapeo de nombre → componente
const ICONS = {
  AstroIcon,
  JavaScriptIcon,
  TypeScriptIcon,
  TailwindIcon,
  GithubIcon,
  EnterIcon,
  ReactIcon,
  ReduxIcon,
  JavaIcon,
  SpringIcon,
  PostgresIcon,
  CSSIcon,
};
---

<!-- CONTENEDOR PRINCIPAL -->
<div class="grid grid-cols-1 gap-8 w-full sm:grid-cols-2 lg:grid-cols-2">
  {projects.map(({ title, description, image, techIcons, repoIcons }, index) => (
    <article class="flex overflow-hidden flex-col items-center bg-white rounded-2xl shadow-lg transition duration-300 dark:bg-gray-900 hover:-translate-y-1 hover:shadow-2xl">
      <img src={image} alt={`Proyecto ${title}`} class="object-cover w-full h-56 sm:h-64 md:h-72" />

      <div class="p-4 w-full text-center">
        <h3 class="text-lg font-semibold text-gray-900 dark:text-white sm:text-xl">
          {t(title)}
        </h3>

        <button
          class="px-4 py-2 mt-4 text-sm text-white bg-blue-600 rounded-lg transition hover:bg-blue-700 sm:text-base"
          onclick={`openModal(${index})`}
        >
          {t("projects.previewMessage")}
        </button>
      </div>
    </article>
  ))}
</div>

<!-- MODALES -->
{projects.map(({ title, description, image, techIcons, repoIcons }, index) => (
  <div id={`modal-${index}`} class="flex hidden fixed inset-0 z-50 justify-center items-center p-2 backdrop-blur-sm sm:p-4 bg-black/40">
    <div class="relative w-full max-w-[90%] sm:max-w-2xl max-h-[90vh] overflow-y-auto p-4 sm:p-6 bg-white rounded-2xl shadow-xl dark:bg-gray-900 animate-fade-scale">
      <button class="absolute top-3 right-3 text-xl text-gray-600 hover:text-gray-900 dark:text-gray-300 dark:hover:text-white" onclick={`closeModal(${index})`}>
        ✕
      </button>

      <h3 class="mb-3 text-xl font-semibold text-center text-gray-900 dark:text-white sm:text-2xl">
        {t(title)}
      </h3>

      <p class="mb-4 text-sm text-gray-800 opacity-80 dark:text-white sm:text-base text-pretty">
        {t(description)}
      </p>

      <div class="flex flex-col gap-3 justify-between items-center mb-4 w-full sm:flex-row">
        <div class="flex flex-wrap gap-2 justify-center sm:justify-start">
          {techIcons.map(({ icon, href }) => {
            const IconComp = ICONS[icon];
            return (
              <SocialPill class="hover:bg-blue-500" href={href}>
                <IconComp />
              </SocialPill>
            );
          })}
        </div>

        <div class="flex flex-wrap gap-2 justify-center sm:justify-end">
          {repoIcons.map(({ icon, href }) => {
            const IconComp = ICONS[icon];
            return (
              <SocialPill class="hover:bg-blue-700" href={href}>
                <IconComp />
              </SocialPill>
            );
          })}
        </div>
      </div>

      <img src={image} alt={`Vista del proyecto ${title}`} class="object-cover mt-4 w-full rounded-lg shadow-xl" />
    </div>
  </div>
))}

<script is:inline>
  function openModal(index) {
    document.getElementById(`modal-${index}`)?.classList.remove("hidden");
    document.body.classList.add("overflow-hidden");
  }
  function closeModal(index) {
    document.getElementById(`modal-${index}`)?.classList.add("hidden");
    document.body.classList.remove("overflow-hidden");
  }
  document.addEventListener("click", (e) => {
    if (e.target.classList.contains("backdrop-blur-sm")) {
      e.target.classList.add("hidden");
      document.body.classList.remove("overflow-hidden");
    }
  });
</script>

<style is:global>
  @keyframes fade-scale {
    from { opacity: 0; transform: scale(0.96) translateY(10px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
  }
  .animate-fade-scale { animation: fade-scale 0.25s ease-out; }
</style>
